<!DOCTYPE HTML>
<TITLE>Tetris</TITLE>
<LINK REL="stylesheet" HREF="https://webdevkit.net/styles.css">
<LINK REL="icon" SIZES="32x32" HREF="Icon/32x32.png">

<!-- GLOBALS -->
<SCRIPT>
function query(selector) {
	let elements = document.querySelectorAll(selector)
	return elements.length > 1 ? elements : elements[0]
}
function listen(elements, types, listener, options) {
	if (types.indexOf(" ") > -1) types = types.split(" ")
	else types = [types]

	if (elements instanceof NodeList === false)
		elements = [elements]
	for (let type of types) 
		for (let element of elements)
			element.addEventListener(type, listener, options)
}
</SCRIPT>

<!-- MOUSE -->
<SCRIPT>
let Mouse = undefined
listen(document, "mousemove", (event) => {
	if (!Mouse) Mouse = {}
	let update = (event) => {
		Mouse.x = Math.round(event.clientX / window.innerWidth * 100) / 100,
		Mouse.y = Math.round(event.clientY / window.innerHeight * 100) / 100
	}
	update(event)
	listen(document, "click mousemove", update)
},	{ once: true })
</SCRIPT>

<!-- KEYBOARD -->
<SCRIPT>
let Keyboard = undefined
listen(document, "keydown", (event) => {
	if (!Keyboard) Keyboard = new Proxy({}, {
		set: (obj, prop, value) => { obj[prop] = value; debug(); return true },
		deleteProperty(obj, prop) { if (prop in obj) { delete obj[prop]; debug() } }
	})
	let animationFrameTimer
	let update = (event) => {
		if (event) {
			if (event.type === "keydown") Keyboard[event.code] = true
			else delete Keyboard[event.code]
		}

		if (Object.keys(Keyboard).length === 0)
			return cancelAnimationFrame(animationFrameTimer)
		animationFrameTimer = requestAnimationFrame(() => update())
	}
	update(event)
	listen(document, "keydown keyup", update)
	listen(window, "blur", () => { for (let key of Object.keys(Keyboard)) delete Keyboard[key] })
}, { once: true })
</SCRIPT>

<STYLE>
Q::before { content: "\201C" }
Q::after { content: "\201D" }

BODY { margin: 0 }

#Tetris { --x: 0.5; --y: 0.5;
font-family: "IBM Plex Serif", sans-serif; font-size: 2.4vh; line-height: 1.4;
max-width: 80ch; margin: 0 auto; padding: 0 2em 25vh; transition: opacity 1s }

#Tetris:not(.loaded) { opacity: 0 }
#Tetris.loaded { opacity: 1 }
#Tetris.visited { opacity: 1 !important }

#Tetris MAIN HEADER {
min-height: 100vh; transition: transform 1s ease-in-out;
display: grid; grid-template-columns: min-content; grid-template-rows: min-content; 
justify-content: center; align-content: center;
transform: translateY(-5vh) }
#Tetris MAIN HEADER H1, #Tetris MAIN HEADER H2 { margin: 0; display: inline-flex }
#Tetris MAIN HEADER H2 { margin-top: -100% }
#Tetris MAIN HEADER.focused { 
transition: transform 0.25s ease-in-out;
transform: translateY(-5vh) scale(1.1) }

#Tetris H3 { text-align: center; margin: 5em 0 2.5em; text-transform: uppercase }

/* CARDS */
#Tetris .card { --flipped: 0; --direction: 1; --maxX: 1; --maxY: 1;
                --offsetX: calc(var(--x) * 2 - 1); --offsetY: calc(var(--y) * 2 - 1);
will-change: box-shadow, transform;
backface-visibility: hidden;
border-radius: 3pt; overflow: hidden; display: inline-flex;
box-shadow: calc(var(--offsetX) * var(--maxX) * -1vmin + 0.5vmin)
            calc(var(--offsetY) * var(--maxY) * -1vmin + 0.5vmin)
            2vmin rgba(0,0,0,0.25);
transition: all 1s cubic-bezier(0.23, 1, 0.32, 1), outline 0s;
transform: perspective(100vmin)
           rotateX(calc(var(--offsetY) * var(--maxY) * -3deg))
           rotateY(calc(var(--offsetX) * var(--maxX) * 3deg + var(--direction) * var(--flipped) * 180deg)) }

#Tetris .card:hover { --maxX: 5; --maxY: 1.5 }
#Tetris .card.flipped { --flipped: 1 }

#Tetris .card.front IMG { opacity: 0 }
#Tetris .card.front { background: url("Artwork/Background.jpg"); background-size: contain; z-index: 1 }

#Tetris .card.back { --flipped: -1 }
#Tetris .card.back.flipped { --flipped: 0 }


/* LAYERS */
#Tetris .card.front::before,
#Tetris .card.front::after { --stack: 0; content: ""; display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
will-change: filter, transform;
filter: drop-shadow(calc(var(--offsetX) * -3px) calc(var(--offsetY) * -3px) 1px rgba(0,0,0,0.2));
transition: all 1s cubic-bezier(0.23, 1, 0.32, 1), outline 0s;
transform: perspective(100vmin)
           translateX(calc(var(--stack) * var(--offsetX) * var(--maxX) * 0.1vmin))
           translateY(calc(var(--stack) * var(--offsetY) * var(--maxY) * 0.1vmin)) }
#Tetris .card.front::before { --stack: 1;
background: url("Artwork/Logo Shadow.png") center no-repeat; background-size: 100% 100% }
#Tetris .card.front::after { --stack: 2;
background: url("Artwork/Logo Fill.png") center no-repeat; background-size: 100% 100% }
</STYLE>
<ARTICLE ID="Tetris">
<MAIN><HEADER>
<H1><A CLASS="card front" HREF="Artwork.jpg"><IMG ALT="Tetris" SRC="Artwork.jpg" WIDTH="512" HEIGHT="512"/></A></H1>
<H2><A CLASS="card back" HREF="Description.jpg"><IMG ALT="From Russia with Fun!" SRC="Description.jpg" WIDTH="512" HEIGHT="512"/></A></H1>
</HEADER></MAIN>
<SCRIPT>
let $tetris = query("#Tetris")
listen(window, "load", () => { setTimeout(() => query("#Tetris").classList.add("loaded"), 500) }) // simulate loading
listen(document, "mousemove", () => {
	if (!Mouse) return
	$tetris.style.setProperty("--x", Mouse.x)
	$tetris.style.setProperty("--y", Mouse.y)
})

setTimeout(() => { localStorage.setItem("tetris", true) }, 4500)
if (localStorage.getItem("tetris")) $tetris.classList.add("visited")


// CARDS
let timeout
for (let card of query("#Tetris .card"))
	listen(card, "mouseenter mouseleave", (event) => {
		if (timeout) clearTimeout(timeout)
		timeout = setTimeout(() => query("#Tetris MAIN HEADER").classList.toggle("focused", event.type === "mouseenter"), event.type === "mouseenter" ? 0 : 1000)
	})

listen(query("#Tetris MAIN HEADER A"), "click", (event) => {
	let normalize = (value, range) => (value * 2 - range) / range
	let normalizedLayerX = normalize(event.layerX, event.target.offsetWidth)
	if (Math.abs(normalizedLayerX) < 0.5) return

	event.preventDefault()
	for (let card of query("#Tetris .card")) {
		card.classList.toggle("flipped")	
		// card.classList.toggle("forwards", normalizedLayerX > 0.5)
		// card.classList.toggle("reversed", normalizedLayerX < 0.5)
	}
})
</SCRIPT>

<STYLE>
#Tetris BLOCKQUOTE { font-size: smaller; margin: 3em auto; max-width: 30em }
#Tetris BLOCKQUOTE HEADER, #Tetris BLOCKQUOTE FOOTER { margin: 2em 0 }

#Tetris #commercial { display: inline-flex; float: right; margin: 1em; position: relative }
#Tetris #commercial::before { content: ""; position: absolute; z-index: 1; top: 0; left: 0; width: 100%; height: 100%;
background-size: contain; background-repeat: no-repeat; background-position: center;
background-image: url("Commercial/Overlay.png") }
#Tetris #commercial::after { content: ""; position: absolute; top: 141px; left: 191px; width: 43px; height: 43px; filter: grayscale(1);
will-change: opacity; transition: opacity 0.5s ease-in-out;
background-size: contain; background-repeat: no-repeat; background-position: center; opacity: 0.5;
background-image: url(https://upload.wikimedia.org/wikipedia/commons/e/e1/YouTube_play_buttom_icon_%282013-2017%29.svg) }
#Tetris #commercial:hover::after { opacity: 0.75; transition-duration: 0.125s; filter: grayscale(0); }
#Tetris #commercial img, #Tetris #commercial iframe, #Tetris #commercial .ytp-spinner { transform: scale(0.63) translate(-13.5%, -12%) }
/* #Tetris #commercial::before, #Tetris #commercial::after { pointer-events: none } */


#Tetris #commercial:not(.playing) iframe { display: none }
#Tetris #commercial.playing::after,
#Tetris #commercial.playing img { display: none }

#Tetris #commercial:not(.buffering) .ytp-spinner { display: none }

#Tetris #commercial.start::after,
#Tetris #commercial.waiting ::after,
#Tetris #commercial.buffering::after { background: none }

#Tetris #commercial.start .ytp-spinner,
#Tetris #commercial.waiting .ytp-spinner,
#Tetris #commercial.buffering .ytp-spinner { display: block; opacity: 0.5; left: 43%; top: 42%; }
.ytp-spinner {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 64px;
    margin-left: -32px;
    z-index: 18;
    pointer-events: none;
}
.ytp-spinner-container {
    pointer-events: none;
    position: absolute;
    width: 100%;
    padding-bottom: 100%;
    top: 50%;
    left: 50%;
    margin-top: -50%;
    margin-left: -50%;
    animation: ytp-spinner-linspin 1568.23529647ms linear infinite;
    -webkit-animation: ytp-spinner-linspin 1568.23529647ms linear infinite;
}
.ytp-spinner-rotator {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-animation: ytp-spinner-easespin 5332ms cubic-bezier(0.4,0.0,0.2,1) infinite both;
    animation: ytp-spinner-easespin 5332ms cubic-bezier(0.4,0.0,0.2,1) infinite both;
}
.ytp-spinner-left {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    overflow: hidden;
}
.ytp-spinner-left {
    right: 49%;
}
.ytp-spinner-right {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
}
.ytp-spinner-right {
    left: 49%;
}
.ytp-spinner-circle {
    box-sizing: border-box;
    position: absolute;
    width: 200%;
    height: 100%;
    border-style: solid;
    border-color: #ddd #ddd transparent;
    border-radius: 50%;
    border-width: 6px;
}
.ytp-spinner-left .ytp-spinner-circle {
    left: 0;
    right: -100%;
    border-right-color: transparent;
    -webkit-animation: ytp-spinner-left-spin 1333ms cubic-bezier(0.4,0.0,0.2,1) infinite both;
    animation: ytp-spinner-left-spin 1333ms cubic-bezier(0.4,0.0,0.2,1) infinite both;
}
.ytp-spinner-right .ytp-spinner-circle {
    left: -100%;
    right: 0;
    border-left-color: transparent;
    -webkit-animation: ytp-right-spin 1333ms cubic-bezier(0.4,0.0,0.2,1) infinite both;
    animation: ytp-right-spin 1333ms cubic-bezier(0.4,0.0,0.2,1) infinite both;
}
@keyframes ytp-spinner-linspin {
to { transform:rotate(360deg) } }
@keyframes ytp-spinner-easespin {
12.5% { transform:rotate(135deg) }
25% { transform:rotate(270deg) }
37.5% { transform:rotate(405deg) }
50% { transform:rotate(540deg) }
62.5% { transform:rotate(675deg) }
75% { transform:rotate(810deg) }
87.5% { transform:rotate(945deg) }
to { transform:rotate(1080deg) } }
@keyframes ytp-spinner-left-spin {
0% { transform:rotate(130deg) }
50% { transform:rotate(-5deg) }
to { transform:rotate(130deg) } }
@keyframes ytp-right-spin {
0% { transform:rotate(-130deg) }
50% { transform:rotate(5deg) }
to { transform:rotate(-130deg) } }

</STYLE>


<A ID="commercial" HREF="javascript:;">
<IMG ALT="Nintendo Game Boy Commercial (1989)" SRC="Commercial/Keyframe.jpg" ALIGN="RIGHT" WIDTH="512"/>
<div class="ytp-spinner"><div class="ytp-spinner-container"><div class="ytp-spinner-rotator"><div class="ytp-spinner-left"><div class="ytp-spinner-circle"></div></div><div class="ytp-spinner-right"><div class="ytp-spinner-circle"></div></div></div></div></div>
<script src="https://youtube.com/iframe_api"></script>
<script src="https://api.dmcdn.net/all.js"></script>
<SCRIPT>
let television = document.querySelector("#commercial")
let player = document.createElement("div")
player.id = `player`
television.appendChild(player)

let commercial

listen(television, "click", event => {
	if (!commercial && event.layerX > 400) {
		commercial = {
			play() { this.player.play() },
			pause() { this.player.pause() },
			player: DM.player(document.getElementById("player"), {
				video: "x1tn4lk",
				width: "512",
				height: "384",
				params: { autoplay: true, mute: true, 'queue-enable': false }
			})
		}
		listen(commercial.player, "start", () => commercial.player.setMuted(0))
		listen(commercial.player, "playing pause end start video_start video_end waiting", event => {
			television.className = event.type
		})
		return
	} else if (!commercial) {
		commercial = {
			play() { this.player.playVideo() },
			pause() { this.player.pauseVideo() },
			player: new YT.Player('player', {
				height: '384',
				width: '512',
				videoId: 'E-ej_8XBwmI',
				playerVars: { 'controls': 0, 'modestbranding': 1, 'autoplay': 1 },
				events: {
					'onStateChange': event => {
						television.className = Object.keys(YT.PlayerState).find(state => YT.PlayerState[state] === event.data).toLowerCase()
					}
				}
			})
		}
		return
	}

	if (television.classList.contains("playing"))
		commercial.pause()
	else
		commercial.play()
})
</SCRIPT>
</A>
<P>Ahhh&hellip; <CITE>Tetris</CITE>. <Q CITE="https://mobygames.com/game/gameboy/tetris_gb/cover-art/gameCoverId,39235">The relentless building block video puzzle</Q> game that launched with Nintendo&rsquo;s Game&nbsp;Boy in 1989.</P>
<P>The title comes from <EM>tetromino</EM> &mdash; a shape that is comprised of four blocks, kind of like how a <EM>domino</EM> is a shape made up of two blocks &mdash; combined with &ldquo;tennis,&rdquo; a favorite activity of the game&rsquo;s original creator Alexey Pajitnov.</P>
<P>While the Tetris franchise has an interesting and complicated history dating back as early as 1984, it was the <EM>Nintendo Game&nbsp;Boy</EM> version that I have the fondest memories of. Whether it was taking turns to get the high score with my mom, dad and brother or playing under the passing streetlights in the back of our van as we drove home from a family gathering, Tetris will always be one of remembered as one of my favorite video games of all time.</P>
<BLOCKQUOTE CITE="https://mobygames.com/game/gameboy/tetris_gb/cover-art/gameCoverId,39236">
<HEADER><P><STRONG>The Soviet Game Sensation!</STRONG></P></HEADER>
<P>Beams, boxes, zig-zags and L-shaped blocks drop down a narrow passage.</P>
<P>Feel your pulse quick as you spin, shift and align the shapes for a perfect fit. It's challenge and demands split second decision!</P>
<P>Start at new heights for a tougher contest. Pick the music and set your pace from 20 progressive skill levels!</P>
<FOOTER><P>&mdash; &ldquo;Tetris&rdquo; Retail Product Packaging, <CITE>Nintendo,</CITE> 1989.</P></FOOTER>
</BLOCKQUOTE>
<P></P>

<STYLE>
#Tetris #Resources UL { list-style: none; padding-left: 0 }
#Tetris #Resources LI { padding-bottom: 1em }

#Tetris #Resources A::before, #Tetris #Resources A::after { content: ""; display: inline-block; text-decoration: none }
#Tetris #Resources A::before { content: "\201C"; }
#Tetris #Resources A::after { content: "\201D"; } 
</STYLE>
<SECTION id="Resources">
<H3>Additional Resources</H3>
<UL>
<LI><A HREF="https://tetris.com">The Addictive Puzzle Game that Started It All!,</A> Alexey Pajitnov and Henk Rogers, <EM>Tetris.com,</EM> <TIME DATETIME="2020-01-01">2020</TIME>.</LI>
<LI><A HREF="https://www.mobygames.com/game/gameboy/tetris_gb">Tetris for Game Boy (1989),</A> 雷堂嬢太朗 (Jotaro Raido), <CITE>Moby Games,</CITE> <TIME DATETIME="2009-12-19">2009</TIME>.</LI>
</UL>
</SECTION>
</ARTICLE>

<!-- DEBUGGER -->
<STYLE>
#debug { position: fixed; z-index: 1; top: 0; left: 0; width: 100vw; height: 100vh; padding: 1em; background: transparent; color: var(--color, black); border: none; pointer-events: none;
font-family: "IBM Plex Mono", monospace; font-weight: 100; font-size: 8pt; background: radial-gradient(circle at 2% 10%, var(--background, white), transparent 15%) }
</STYLE>
<DIV ID="debug" STYLE="opacity: 1">&nbsp;</DIV>
<SCRIPT>
let $debug = document.querySelector("#debug");
if ($debug.style.opacity) {
	listen(window, "resize", debug)
	listen(document, "click mousemove keydown keyup scroll", debug)

	function debug(event) {
		let printLine = (line) => $debug.innerHTML += `${line}<BR/>`
		$debug.innerHTML = ``

		let userAgentTokens = navigator.userAgent.match(/[^\/ ]*\/[^\/ ]*( \([^\)]*\))?/g)
		let platform = 'platform' in navigator ? navigator.platform : ''
		platform = userAgentTokens[0].match(/Mac OS X 10_1[2345](_\d*)?/)[0].replace(/_/g, '.').replace('Mac OS X', ' macOS')
		printLine(`Platform: ${platform}`)
		printLine(``)
		printLine(`Screen Size: ${'screen' in window ? window.screen.width : '?'}, ${'screen' in window ? window.screen.height : '?'}`)
		printLine(`Screen Color Depth: ${'screen' in window ? window.screen.colorDepth + '-bit' : '?'}`)
		printLine(`Screen Pixel Depth: ${'screen' in window ? window.screen.pixelDepth + '-bit' : '?'}`)
		printLine(``)
		printLine(`Window Size: ${'innerWidth' in window ? window.innerWidth : '?'}, ${'innerHeight' in window ? window.innerHeight : '?'}`)
		printLine(`Window Scroll: ${'scrollX' in window ? window.scrollX : '?'}, ${'scrollY' in window ? window.scrollY : '?'}`)
		printLine(``)
		if (Mouse) {
			let buttonMap = `┑Main ┰Auxiliary ┍Secondary`.split(" ")
			printLine(`Mouse Client: ${event && 'clientX' in event ? event.clientX + ', ' + event.clientY : ''}`)
			printLine(`Mouse Layer: ${event && 'layerX' in event ? event.layerX + ', ' + event.layerY : ''}`)
			printLine(`Mouse Page: ${event && 'pageX' in event ? event.pageX + ', ' + event.pageY : ''}`)
			printLine(`Mouse Screen: ${event && 'screenX' in event ? event.screenX + ', ' + event.screenY : ''}`)
			printLine(`Mouse Buttons: ${event ? buttonMap.filter((button, index) => (((event.type === "click" ? 1 : 0) << event.button) | event.buttons) & (1 << index)).map(button => button[0]) : ''}`)
			printLine(``)
		}

		let keys = ``
		if (Keyboard) {
			const larger = (text) => `<span style="line-height:0.67em; font-size:1.5em">${text}</span>`
			let displayMap = `⌘MetaLeft ⌘MetaRight ⌃ControlLeft ⌃ControlRight ⌥AltLeft ⌥AltRight [BracketLeft ]BracketRight \`Backquote \\Backslash /Slash .Period
         -Minus =Equal ,Comma ;Semicolon 'Quote ⎵Space ↵Enter ⌫Backspace ⌦Delete ⎋Escape →ArrowRight ←ArrowLeft ↑ArrowUp ↓ArrowDown ⇞PageUp ⇟PageDown ↖Home ↘End
			⇪CapsLock ⇧ShiftLeft ⇧ShiftRight ⇥Tab ⓪Numpad0 ①Numpad1 ②Numpad2 ③Numpad3 ④Numpad4 ⑤Numpad5 ⑥Numpad6 ⑦Numpad7 ⑧Numpad8 ⑨Numpad9 ⊜NumpadEqual 
         ⨸NumpadDivide ⊗NumpadMultiply ⊝NumpadSubtract ⊕NumpadAdd ⏎NumpadEnter`
			keys = Object.keys(Keyboard).map(key => {
				let display = key.replace(/Digit|Key/g, '')
				if (displayMap.indexOf(key) > -1) display = displayMap[displayMap.indexOf(key) - 1]
				return display
			})
			printLine(`Keyboard: ${keys.length ? keys.join('') : ''}`)
		}
	}
	debug()
}
</SCRIPT>